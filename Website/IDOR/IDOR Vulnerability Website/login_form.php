<?php
@include 'config.php';

if(isset($_POST['submit'])){
    $email = mysqli_real_escape_string($conn, $_POST['email']);
    //$pass = $_POST['password'];
    $pass = password_hash($_POST['password'], PASSWORD_DEFAULT);
    

    $select = " SELECT * FROM users WHERE email = '$email'";
    $result = mysqli_query($conn, $select);

    if(mysqli_num_rows($result) > 0){
        $row = mysqli_fetch_array($result);

        if( $pass !== $row['password'])/*password_verify($pass, $row['password'])*/{
            // Set cookie untuk autentikasi pengguna
            if($row ['email'] === 'admin@admin.com') {
                setcookie('user_type', 'admin', time() + (86400 * 30), "/"); // Cookie set for 30 days
                setcookie('admin_name', $row['name'], time() + (86400 * 30), "/"); // Cookie set for 30 days
                header('Location: admin_page.php');
            } else {
                setcookie('user_type', 'user', time() + (86400 * 30), "/"); // Cookie set for 30 days
                setcookie('user_id', $row['id'], time() + (86400 * 30), "/"); // Cookie set for 30 days
                setcookie('user_name', $row['name'], time() + (86400 * 30), "/"); // Cookie set for 30 days
                setcookie('user_email', $row['email'], time() + (86400 * 30), "/"); // Cookie set for 30 days
                header('Location: homepage.php');
            }
            exit();
        } else {
            $error[] = 'Incorrect email or password!';
        }
    } else {
        $error[] = 'User not found!';
    }
}
?>


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE-edge">
    <title>Login</title>

    <link rel="stylesheet" href="css/styles.css">
</head>

<body>
    <div class="form-container">
        <form action="" method="post">
            <h3>LOGIN</h3>
            <?php
                if(isset($error)){
                    foreach($error as $error){
                        echo '<span class="error-msg">'.$error.'</span>';
                    };
                };
            ?>
            <input type="email" name="email" required placeholder="Enter your email">
            <input type="password" name="password" required placeholder="Enter your password">
            <input type="submit" name="submit"value="Login" class="form-btn">
            <p>Don't have and account?<a href="register_form.php"> Register Here</a></p>
        </form>
    </div>
</body>
</html>